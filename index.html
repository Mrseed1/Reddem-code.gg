<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Promo Code Redemption</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(to top right, rgba(45, 79, 255, 0.2), rgba(130, 32, 255, 0.2));
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      font-family: sans-serif;
    }
    .input-box {
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 12px;
      border-radius: 8px;
      color: white;
      width: 280px;
      text-align: center;
      outline: none;
    }
    .input-box::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    .inventory-item {
      display: flex;
      align-items: center;
      margin: 10px;
      background-color: rgba(255, 255, 255, 0.2);
      padding: 10px;
      border-radius: 10px;
      width: 280px;
    }
    .inventory-item img {
      width: 50px;
      height: 50px;
      margin-right: 10px;
    }
    .inventory-item .item-info {
      color: white;
    }
  </style>
</head>
<body class="bg-black bg-gradient-to-tr from-[#2d4eff33] to-[#8220ff33] h-screen flex flex-col items-center justify-center">

  <h1 class="text-white text-3xl font-bold mb-4" id="pageTitle">Promo Code Redemption</h1>

  <div id="loginSection">
    <div id="promoCodeSection" style="display: none;">
      <input type="text" id="promoCode" class="input-box mb-3" placeholder="Promo Code">
      <button onclick="redeemPromo()" class="bg-purple-600 text-white px-4 py-2 rounded-lg" id="redeemButton">Redeem</button>
    </div>
  </div>

  <div id="registerSection">
    <button onclick="register()" class="bg-blue-600 text-white px-4 py-2 rounded-lg mt-4" id="registerButton">Register</button>
  </div>

  <div id="inventorySection" style="display:none;">
    <h2 class="text-white text-xl font-bold mb-4">Inventory</h2>
    <div id="inventoryList"></div>
    <button onclick="goBackToHome()" class="bg-gray-600 text-white px-4 py-2 rounded-lg mt-4">Back to Home</button>
  </div>

  <p id="message" class="text-white mt-3"></p>

  <button onclick="goToInventory()" class="bg-green-600 text-white px-4 py-2 rounded-lg mt-3" id="inventoryButton" style="position: absolute; top: 20px; right: 20px; display:none;">Inventory</button>

  <script>
    // Пример кодов с количеством использования
    const promoCodes = {
      "Mr_Seed_1": { reward: "Mr_Seed_1 Item", usageLimit: 5, imageUrl: "https://img09.rl0.ru/afisha/e1200x1200i/daily.afisha.ru/uploads/images/2/60/26009f58d792dcfffd2ef046e5edd22b.jpg" },
      "NEWYEAR2025": { reward: "100 Robux", usageLimit: 5, imageUrl: "https://via.placeholder.com/50" }
    };

    // Проверка, был ли зарегистрирован пользователь
    if (localStorage.getItem("username")) {
      const username = localStorage.getItem("username");
      document.getElementById("pageTitle").textContent = `${username}'s Inventory`;
      document.getElementById("registerSection").style.display = "none";
      document.getElementById("loginSection").style.display = "block";
      document.getElementById("inventoryButton").style.display = "block"; // Показать кнопку инвентаря
      document.getElementById("promoCodeSection").style.display = "block"; // Показать форму для кода
    }

    // Регистрация пользователя
    function register() {
      const username = prompt("Enter a username to register:");
      if (username) {
        if (localStorage.getItem("username")) {
          alert("You are already registered!");
        } else {
          localStorage.setItem("username", username);
          document.getElementById("pageTitle").textContent = `${username}'s Inventory`;
          document.getElementById("registerSection").style.display = "none";
          document.getElementById("loginSection").style.display = "block";
          document.getElementById("inventoryButton").style.display = "block"; // Показать кнопку инвентаря
          document.getElementById("promoCodeSection").style.display = "block"; // Показать форму для кода
        }
      }
    }

    // Функция для ввода промокода
    function redeemPromo() {
      const promoCode = document.getElementById("promoCode").value.trim();
      const message = document.getElementById("message");

      const username = localStorage.getItem("username");
      if (!username) {
        message.textContent = "Please register first to use promo codes.";
        message.style.color = "red";
        return;
      }

      if (!promoCode) {
        message.textContent = "Please enter a promo code.";
        message.style.color = "red";
        return;
      }

      const codeDetails = promoCodes[promoCode];
      if (codeDetails) {
        // Проверка на количество использований
        let usedTimes = localStorage.getItem(promoCode) || 0;
        usedTimes = parseInt(usedTimes);

        if (usedTimes < codeDetails.usageLimit) {
          // Успешное использование промокода
          localStorage.setItem(promoCode, usedTimes + 1);
          message.textContent = `Success! You received: ${codeDetails.reward}`;
          message.style.color = "lightgreen";
          addToInventory(codeDetails.reward, codeDetails.imageUrl);
        } else {
          message.textContent = `This code has already been used the maximum number of times.`;
          message.style.color = "red";
        }
      } else {
        message.textContent = "Invalid promo code.";
        message.style.color = "red";
      }
    }

    // Переключение между страницами
    function goToInventory() {
      const username = localStorage.getItem("username");
      if (!username) {
        alert("You must register first.");
        return;
      }
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("registerSection").style.display = "none";
      document.getElementById("inventorySection").style.display = "block";
      document.getElementById("inventoryButton").style.display = "none"; // скрыть кнопку инвентаря
      displayInventory();
    }

    // Возврат на главную страницу (не выход из аккаунта)
    function goBackToHome() {
      document.getElementById("inventorySection").style.display = "none";
      document.getElementById("loginSection").style.display = "block";
      document.getElementById("registerSection").style.display = "none";
      document.getElementById("inventoryButton").style.display = "block"; // показать кнопку инвентаря
      document.getElementById("promoCodeSection").style.display = "block"; // показать форму для кода
    }

    // Добавление предметов в инвентарь
    function addToInventory(item, imageUrl) {
      const username = localStorage.getItem("username");
      const inventory = JSON.parse(localStorage.getItem(username + "_inventory")) || [];
      inventory.push({ item, imageUrl });
      localStorage.setItem(username + "_inventory", JSON.stringify(inventory));
    }

    // Отображение инвентаря
    function displayInventory() {
      const inventoryList = document.getElementById("inventoryList");
      const username = localStorage.getItem("username");
      const inventory = JSON.parse(localStorage.getItem(username + "_inventory")) || [];
      inventoryList.innerHTML = "";

      if (inventory.length === 0) {
        inventoryList.innerHTML = `<p class="text-white">No items in your inventory.</p>`;
      }

      inventory.forEach((item, index) => {
        const inventoryItem = document.createElement("div");
        inventoryItem.classList.add("inventory-item");

        const itemImage = document.createElement("img");
        itemImage.src = item.imageUrl;

        const itemInfo = document.createElement("div");
        itemInfo.classList.add("item-info");
        itemInfo.textContent = item.item;

        // Кнопка для удаления предмета
        const deleteButton = document.createElement("button");
        deleteButton.textContent = "Delete";
        deleteButton.classList.add("bg-red-500", "text-white", "px-2", "py-1", "rounded-lg", "ml-3");
        deleteButton.onclick = function() {
          const confirmation = confirm("Are you sure you want to delete this item?");
          if (confirmation) {
            removeItemFromInventory(index);
          }
        };

        inventoryItem.appendChild(itemImage);
        inventoryItem.appendChild(itemInfo);
        inventoryItem.appendChild(deleteButton);
        inventoryList.appendChild(inventoryItem);
      });
    }

    // Удаление предмета из инвентаря
    function removeItemFromInventory(index) {
      const username = localStorage.getItem("username");
      const inventory = JSON.parse(localStorage.getItem(username + "_inventory")) || [];
      inventory.splice(index, 1);  // Удаление элемента из массива
      localStorage.setItem(username + "_inventory", JSON.stringify(inventory));
      displayInventory();  // Обновить инвентарь
    }
  </script>
</body>
</html>
